<!DOCTYPE html>
<html lang="es">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="stylesheet" href="tablero.css" />
  <title>Tablero de control del propietario</title>

  <script src="vistaWeb.js"></script>
</head>

<body>
  <script src="utilesVista.js"></script>
  <div class="container">
    <h1>Tablero de control del propietario</h1>

    <div class="section summary">
      <div>
        <label>Nombre completo:</label>
        <p id="nombreCompleto"></p>
      </div>
      <div>
        <label>Estado:</label>
        <p id="estado"></p>
      </div>
      <div>
        <label>Saldo actual:</label>
        <p id="saldoactual"></p>
      </div>
    </div>

    <table id="tablaBonificaciones" class="section">
      <h2>Bonificaciones</h2>
      <thead>
        <tr>
          <th>Bonificación</th>
          <th>Puesto</th>
          <th>Fecha Asignada</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
    <table id="tablaVehiculos">
      <h2>Vehiculos</h2>
      <thead>
        <tr>
          <th>Matrícula</th>
          <th>Modelo</th>
          <th>Color</th>
          <th>Cant. Tránsitos</th>
          <th>Monto Total</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
    <table id="tablaTransitos">
      <h2>Tránsitos</h2>
      <thead>
        <tr>
          <th>Puesto</th>
          <th>Vehículo</th>
          <th>Categoría</th>
          <th>Tarifa Base</th>
          <th>Monto Final</th>
          <th>Fecha</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
    <h2>Notificaciones</h2>
    <table id="tablaNotificaciones">
      <thead>
        <tr>
          <th>Fecha/Hora</th>
          <th>Mensaje</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
    <div class="notifications">
      <button id="btnBorrarNotificaciones" class="btn-borrar" onclick="borrarNotificaciones()">
        Borrar notificaciones
      </button>
    </div>
  </div>
  </div>
  <script>
    urlIniciarVista = "/tablero/vistaConectada";
    
    const URL_BORRAR_NOTIF = "/tablero/borrarNotificaciones";
    urlCierreVista = "/tablero/vistaCerrada";
    
    // Función para formatear fechas
    function formatearFecha(fecha) {
      if (!fecha) return "N/A";
      const date = new Date(fecha);
      const dia = String(date.getDate()).padStart(2, '0');
      const mes = String(date.getMonth() + 1).padStart(2, '0');
      const año = date.getFullYear();
      const horas = String(date.getHours()).padStart(2, '0');
      const minutos = String(date.getMinutes()).padStart(2, '0');
      return `${dia}/${mes}/${año} ${horas}:${minutos}`;
    }
    
    // Función para formatear solo la fecha sin hora
    function formatearFechaSolo(fecha) {
      if (!fecha) return "N/A";
      const date = new Date(fecha);
      const dia = String(date.getDate()).padStart(2, '0');
      const mes = String(date.getMonth() + 1).padStart(2, '0');
      const año = date.getFullYear();
      return `${dia}/${mes}/${año}`;
    }
    function mostrar_nombreCompleto(nombreCompleto) {
      document.getElementById("nombreCompleto").innerHTML = nombreCompleto;
    }
    function mostrar_estado(estado) {
      document.getElementById("estado").innerHTML = estado;
    }

    function mostrar_saldoactual(saldoactual) {
      document.getElementById("saldoactual").innerHTML = saldoactual;
    }

    function mostrar_vehiculos(vehiculos) {
      const tbody = document.querySelector("#tablaVehiculos tbody");
      tbody.innerHTML = "";

      for (let i = 0; i < vehiculos.length; i++) {
        const v = vehiculos[i];
        const fila = `
    <tr>
      <td>${v.matricula}</td>
      <td>${v.modelo}</td>
      <td>${v.color}</td>
      <td>${v.cantTransitos}</td>
      <td>$ ${v.montoTotal}</td>
    </tr>`;
        tbody.innerHTML += fila;
      }
    }

    function mostrar_bonificaciones(bonificaciones) {
      const tbody = document.querySelector("#tablaBonificaciones tbody");
      tbody.innerHTML = "";

      for (let i = 0; i < bonificaciones.length; i++) {
        const b = bonificaciones[i];
        const fila = `
    <tr>
      <td>${b.bonificacion}</td>
      <td>${b.puesto}</td>
      <td>${formatearFechaSolo(b.fechaAsignada)}</td>
    </tr>`;
        tbody.innerHTML += fila;
      }
    }

    function mostrar_transitos(transitos) {
      const tbody = document.querySelector("#tablaTransitos tbody");
      tbody.innerHTML = "";

      for (let i = 0; i < transitos.length; i++) {
        const t = transitos[i];
        const fila = `
    <tr>
      <td>${t.puestoPeajeNombre}</td>
      <td>${t.vehiculoMat}</td>
      <td>${t.categoria}</td>
      <td>$ ${t.tarifaMonto}</td>
      <td>$ ${t.monto}</td>
      <td>${formatearFecha(t.fecha)}</td>
    </tr>`;
        tbody.innerHTML += fila;
      }
    }

    function mostrar_notificaciones(notificaciones) {
      const tbody = document.querySelector("#tablaNotificaciones tbody");
      tbody.innerHTML = "";

      for (let i = 0; i < notificaciones.length; i++) {
        const n = notificaciones[i];
        const fila = `
    <tr>
      <td>${formatearFecha(n.fechaHora)}</td>
      <td>${n.mensaje}</td>
    </tr>`;
        tbody.innerHTML += fila;
      }
    }
    function borrarNotificaciones() {
      submit(URL_BORRAR_NOTIF,{});
    }
  </script>
</body>

</html>